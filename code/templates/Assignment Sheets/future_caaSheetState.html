{% extends "base.html" %} {% block content %}

<!--Content Here-->
<!--Jumbotron-->
<div class="jumbotron py-3">
    <div class="jumbotron-content">
        <div class="row justify-content-md-center">
            <h1 class="jumbotron-title col">Future Shift Planning Page</h1>
        </div>
        <label for="future_datetime" class="pt-3"><strong>Set Shift Time</strong></label><br>
        <input type="date" id="shiftDate" class="form-control-sm" value={{date}}>
        <input type="time" id="shiftTime" class="form-control-sm" value={{time}}>

        <form id="save-future-form" action="/futureSave" method="POST">
            <a href="#" id="saveFutureSubmit" style="position: absolute; right: 113px; top: 55px;">
                <!-- <i class="fas fa-save fa-3x" style="color:black"></i> -->
                <i class="bi bi-save2" style="color:black"></i>
                <br><small>Save</small>
                <a href="#" id="saveFutureSubmit" style="position: absolute; right: 100px; top: 35px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="black" class="bi bi-save2" viewBox="0 0 18 18">
                        <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v4.5h2a.5.5 0 0 1 .354.854l-2.5 2.5a.5.5 0 0 1-.708 0l-2.5-2.5A.5.5 0 0 1 5.5 6.5h2V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"/>
                    </svg> 
                </a>
            </a>
            <!-- <a href="#" id="saveFutureSubmit" style="position: absolute; right: 110px; top: 30px;">
                <i class="fas fa-save fa-3x" style="color:black"></i>
                <br><small>Save</small>
            </a> -->
            <input id="saveFutureData" type="text" name="saveFutureData" hidden>
            <input id="shiftDateData" type="text" name="shiftDate" hidden>
            <input id="shiftTimeData" type="text" name="shiftTime" hidden>
        </form>

        <a href="#" onclick="printPage()" style="position: absolute; right: 50px; top: 55px;">
            <!-- <i class="fas fa-print fa-3x" style="color:black"></i> -->
            <i class="bi bi-printer" style="color:black"></i>
            <br><small>Print</small>
            <a href="#" onclick="printPage()"style="position: absolute; right: 35px; top: 35px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="black" class="bi bi-printer" viewBox="0 0 18 18">
                    <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>
                    <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>
              </svg>
            </a>
        </a>
        <!-- <a href="#" onclick="printPage()" style="position: absolute; right: 50px; top: 30px;">
            <i class="fas fa-print fa-3x" style="color:black"></i>
            <br><small>Print</small>
        </a> -->

        <a href="/futureCAASheet" style="position: absolute; right: 170px; top: 55px;">
            <!-- <i class="fas fa-plus fa-3x" style="color:black"></i> -->
            <i class="bi bi-file-earmark-plus" style="color:black"></i>
            <br><small>New Shift</small>
            <a href="/futureCAASheet" style="position: absolute; right: 170px; top: 35px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="black" class="bi bi-file-earmark-plus" viewBox="0 0 18 18">
                    <path d="M8 6.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V11a.5.5 0 0 1-1 0V9.5H6a.5.5 0 0 1 0-1h1.5V7a.5.5 0 0 1 .5-.5z"/>
                    <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                </svg>
            </a>
        </a>

        <!-- <a href="/futureCAASheet" style="position: absolute; right: 170px; top: 30px;">
            <i class="fas fa-plus fa-3x" style="color:black"></i>
            <br><small>New Shift</small>
        </a> -->

        <a href="/futureCAASheet" style="position: absolute; right: 250px; top: 55px;">
            <i class="bi bi-calendar-plus" style="color:black"></i>
            <br><small>Add To Current Shift</small>
        </a>
        <a href="/futureCAASheet" style="position: absolute; right: 280px; top: 35px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="black" class="bi bi-calendar-plus" viewBox="0 0 18 18">
            <path d="M8 7a.5.5 0 0 1 .5.5V9H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V10H6a.5.5 0 0 1 0-1h1.5V7.5A.5.5 0 0 1 8 7z"/>
            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
            </svg>
        </a>

        <!--Load State-->
        <div class="text-left" style="position: absolute; top: 1%; left: 5%">
            <form class="form form-group" action="/futureCAASheetState" method="POST">
                <label for="date-select">
                    <small>Shift</small>
                </label>
                <select id="date-select" class="form-control form-control-sm col-10" name="date-select">
                    {% for i, state in enumerate(states) %}
                    <option id="shift-{{i}}" value="{{i}}">{{state}}</option>
                    {% endfor %}
                </select>
                <button class="btn btn-sm btn-block btn_create_custom" id="date-change-btn" type="submit">Load</button>
            </form>
        </div>
        <br><br>
        <!--Charge Nurse-->
        <div class="row">
            <div class="col rounded pt-3 px-4 mx-5 shadow-sm" style="background-color: lightgray">
                <div class="row justify-content-center">
                    <div class="col-9">
                        <h6>Charge Nurses</h6>
                    </div>
                    <div class="col-3">
                        <h6>Skill Level</h6>
                    </div>
                </div>
                {% for i in range(3)%}
                <div class="row justify-content-center mb-2">
                    <select class="col-8 form-control form-control-sm rounded text-center" id="CN{{i}}" type="text"
                        value="" onchange="updateCNDetails()">
                        {% if currState['charge'][i] %}
                        {% for nurse in futureList if nurse[0] == currState['charge'][i]|int %}
                        <option id='cn-assign-{{nurse[0]}}' value="{{nurse[0]}}" data-skill="{{nurse[7]}}" selected>
                            {{nurse[1]}}
                        </option>
                        {% endfor %}
                        {% endif %}
                        <option id="blank-cn"></option>
                        {% for index, nurse in enumerate(futureList) %}
                        {% if nurse[11] == "Charge" %}
                        <option class="table-success" id='cn-assign-{{nurse[0]}}' value="{{nurse[0]}}"
                            data-skill="{{nurse[7]}}">
                            {{nurse[1]}}
                        </option>
                        {% else %}
                        <option id='cn-assign-{{nurse[0]}}' value="{{nurse[0]}}" data-skill="{{nurse[7]}}">
                            {{nurse[1]}}
                        </option>
                        {% endif %}
                        {% endfor %}
                    </select>

                    {% if currState['charge'][i] %}
                    {% for nurse in futureList if nurse[0] == currState['charge'][i]|int %}
                    <input class="col-2 offset-1 form-control form-control-sm rounded text-center" type="text"
                        id="CN_skill{{i}}" value="{{nurse[7]}}" disabled>
                    {% endfor %}
                    {% else %}
                    <input class="col-2 offset-1 form-control form-control-sm rounded text-center" type="text"
                        id="CN_skill{{i}}" value="" disabled>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            <!--Support Nurses-->
            <div class="col rounded pt-3 pl-4 pr-5 mx-5 shadow-sm" style="background-color: lightgray;">
                <div class="row justify-content-center">
                    <div class="col-6">
                        <h6>Support Nurses</h6>
                    </div>
                    <div class="col-2">
                        <h6>Area</h6>
                    </div>
                    <div class="col-2">
                        <h6>Rotation</h6>
                    </div>
                </div>
                {% for i in range(3)%}
                <div class="row justify-content-center mb-2">
                    <select class="col-6 form-control form-control-sm rounded text-center" type="text" value=""
                        id="SN{{i}}" onchange="updateSNDetails()">
                        {% if currState['support'][i] %}
                        {% for nurse in futureList if nurse[0] == currState['support'][i]|int %}
                        <option id='sn-assign-{{nurse[0]}}' value="{{nurse[0]}}" data-skill="{{nurse[7]}}" selected>
                            {{nurse[1]}}
                        </option>
                        {% endfor %}
                        {% endif %}
                        <option id="blank-sn"></option>
                        {% for index, nurse in enumerate(futureList) %}
                        {% if nurse[11] == "Support" %}
                        <option class="table-warning" id='sn-assign-{{nurse[0]}}' value="{{nurse[0]}}"
                            data-area="{{nurse[2]}}" data-rotation="{{nurse[4]}}">
                            {{nurse[1]}}
                        </option>
                        {% else %}
                        <option id='sn-assign-{{nurse[0]}}' value="{{nurse[0]}}" data-area="{{nurse[2]}}"
                            data-rotation="{{nurse[4]}}">{{nurse[1]}}</option>
                        {% endif %}
                        {% endfor %}
                    </select>

                    {% if currState['support'][i] %}
                    {% for nurse in futureList if nurse[0] == currState['support'][i]|int %}
                    <input class="col-2 offset-1 form-control form-control-sm rounded text-center" type="text"
                        id="SN_area{{i}}" value="{{nurse[2]}}" disabled>
                    <input class="col-2 form-control form-control-sm rounded text-center" type="text"
                        id="SN_rotation{{i}}" value="{{nurse[4]}}" disabled>
                    {% endfor %}
                    {% else %}
                    <input class="col-2 offset-1 form-control form-control-sm rounded text-center" type="text"
                        id="SN_area{{i}}" value="" disabled>
                    <input class="col-2 form-control form-control-sm rounded text-center" type="text"
                        id="SN_rotation{{i}}" value="" disabled>
                    {% endif %}

                </div>
                {% endfor %}
            </div>
            <!--Right Column-->
            <div class="col mx-5">
                <div class="row w-100 px-2 shadow-sm"
                    style="background-color: lightgray; padding: 10px 30px; border-radius: 5px;">
                    <div class="col-4">
                        <h6>Code RN</h6>
                    </div>
                    <select class="col-6 form-control form-control-sm rounded text-center" type="text" value="">
                        {% if currState['code'][0] %}
                        {% for nurse in futureList if nurse[0] == currState['code'][0]|int %}
                        <option id='code-assign-{{nurse[0]}}' value="{{nurse[0]}}" selected>
                            {{nurse[1]}}
                        </option>
                        {% endfor %}
                        {% endif %}
                        <option id="blank-code" value=""></option>
                        {% for index, nurse in enumerate(futureList) %}
                        {% if nurse[11] == "Code" %}
                        <option class="table-danger" id='code-assign-{{nurse[0]}}' value="{{nurse[0]}}">
                            {{nurse[1]}}
                        </option>
                        {% else %}
                        <option id='code-assign-{{nurse[0]}}' value="{{nurse[0]}}">{{nurse[1]}}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                    <div class="col-1"></div>
                </div>
                <div class="mt-5 rounded col-12 row w-100 px-2 shadow-sm"
                    style="background-color: lightgray; padding: 10px 30px; width: 100px">
                    <div class="row col-12">
                        <h6 class="mt-1 col-4">Fixed</h6>
                        <select class="col-4 ml-2 mb-2 form-control form-control-sm rounded text-center" type="text">
                            {% if currState['fixed'] %}
                            <option id="fixed-{{currState['fixed']}}" value="{{currState['fixed']}}">
                                {{currState['fixed']}}
                            </option>
                            {% endif %}
                            <option id="fixed-blank" value=""></option>
                            {% for i, x in enumerate(range(8)) %}
                            <option id='fixed-{{i+1}}' value="{{i+1}}">{{i+1}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="row col-12">
                        <h6 class="mt-1 col-4">Flex</h6>
                        <select class="col-4 ml-2 mb-2 form-control form-control-sm rounded text-center" type="text">
                            {% if currState['flex'] %}
                            <option id="fixed-{{currState['flex']}}" value="{{currState['flex']}}">
                                {{currState['flex']}}
                            </option>
                            {% endif %}
                            <option id="flex-blank" value=""></option>
                            {% for i, x in enumerate(range(8)) %}
                            <option id='flex-{{i+1}}' value="{{i+1}}">{{i+1}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br>
</div>

{% set areas=["A", "B", "C", "D", "E", "F"] %}
{% set area_iter = namespace(value=0) %}

<div class="container-fluid px-5">
    <div class="justify-content-center">
        <div class="col-12">
            <!--Clinical Area Container-->
            {% for k in range(6) %}
            <div class="row col-12 mb-3 m-0 p-0 shadow-sm" style="border-radius: 10px; border: 1px solid lightgrey;">
                <div style="border-top-left-radius: 10px; border-bottom-left-radius: 10px;" {% if area_iter.value < 4 %}
                    class="pod-norm px-4 py-2" {% else %} class="pod-spec px-4 py-2" {% endif %}>
                    <p class="text-center" style="margin-top: 125px;"><b>{{areas[area_iter.value]}}</b></p>
                </div>
                {% for j in range(2) %}
                <div class="col-5">
                    <div class="row justify-content-center">
                        <div class="col-7">
                            <small class="mt-1"><b>Name</b></small>
                        </div>
                        <div class="col-1 mx-1">
                            <small class="mt-1"><b>Skill</b></small>
                        </div>
                        <div class="col-1 mx-1 ">
                            <small class="mt-1"><b>Group</b></small>
                        </div>
                        <div class="col-1 mx-1">
                            <small class="mt-1"><b>Shift</b></small>
                        </div>
                        <div class="col-1">
                        </div>
                    </div>
                    {% for i in range(7) %}
                    {% set row_col_num = (7*j + i) %}
                    <div class="row justify-content-center mb-2">
                        <select class="col-7 form-control form-control-sm rounded text-center mx-1" type="text" value=""
                            id="Nurse{{k}}{{j}}{{i}}" onchange="updateNurseDetails()">
                            {% if currState['assignment'][areas[area_iter.value]][row_col_num] %}
                            {% set currentId = currState['assignment'][areas[area_iter.value]][row_col_num] %}
                            {% for nurse in futureList if nurse[0] == currentId|int %}
                            <option id='{{areas[area_iter.value]}}-{{nurse[0]}}' value="{{nurse[0]}}">
                                {{nurse[1]}}
                            </option>
                            {% endfor %}
                            {% endif %}
                            <option id="blank-nurse-{{i+1}}" value=""></option>
                            {% for index, nurse in enumerate(futureList) %}
                            <option id='{{areas[area_iter.value]}}-{{nurse[0]}}' value="{{nurse[0]}}"
                                data-skill={{nurse[7]}} data-group={{nurse[5]}} data-rotation={{nurse[4]}}>
                                {{nurse[1]}}
                            </option>
                            {% endfor %}
                        </select>

                        {% if currentId %}
                        {% for nurse in futureList if nurse[0] == currentId|int %}
                        <input class="col-1 form-control form-control-sm rounded text-center mx-1" type="text"
                            id="Nurse_skill{{k}}{{j}}{{i}}" value="{{nurse[7]}}" disabled>
                        <input class="col-1 form-control form-control-sm rounded text-center mx-1" type="text"
                            id="Nurse_group{{k}}{{j}}{{i}}" value="{{nurse[5]}}" disabled>
                        <input class="col-1 form-control form-control-sm rounded text-center mx-1" type="text"
                            id="Nurse_rotation{{k}}{{j}}{{i}}" value="{{nurse[4]}}" disabled>
                        <button class="col-1 btn form-control-sm btn-warning mx-1 invisible" data-toggle="modal"
                            data-target="#flagModal">
                            <i class="fas fa-exclamation-circle"></i></button>
                        {% endfor %}
                        {% else %}
                        <input class="col-1 form-control form-control-sm rounded text-center mx-1" type="text"
                            id="Nurse_skill{{k}}{{j}}{{i}}" value="" disabled>
                        <input class="col-1 form-control form-control-sm rounded text-center mx-1" type="text"
                            id="Nurse_group{{k}}{{j}}{{i}}" value="" disabled>
                        <input class="col-1 form-control form-control-sm rounded text-center mx-1" type="text"
                            id="Nurse_rotation{{k}}{{j}}{{i}}" value="" disabled>
                        <button class="col-1 btn form-control-sm btn-warning mx-1 invisible" data-toggle="modal"
                            data-target="#flagModal">
                            <i class="fas fa-exclamation-circle"></i></button>
                        {% endif %}

                        {% set currentId=null %}

                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
            {% set area_iter.value = area_iter.value + 1 %}
            {% endfor %}
        </div>
    </div>
</div>

<!--Flag Modal-->
<div class="modal fade" id="flagModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="flagModalLabel">DTA/Comments for </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h6>Comments</h6>
                <small id="flag-comment"></small>
                <hr>
                <h6>DTA</h6>
                <small id="flag-dta"></small>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Save State
    $("#saveFutureSubmit").on("click", (event) => {
        var saveFutureData = []
        var selectedList = document.querySelectorAll("option:checked")
        for (item in selectedList) {
            if (selectedList[item].value != "") {
                saveFutureData.push(selectedList[item].id)
            }
        }
        $("#saveFutureData").val(JSON.stringify(saveFutureData))

        console.log($("#saveFutureData").val())
        $("#shiftTimeData").val($("#shiftTime").val())
        $("#shiftDateData").val($("#shiftDate").val())
        $("#save-future-form").submit()
    })

    function updateCNDetails() {
        const chargenurse1 = document.querySelector('#CN0 option:checked');
        if (chargenurse1.value != "") {
            document.getElementById("CN_skill0").value = chargenurse1.dataset.skill;
        }
        else {
            document.getElementById("CN_skill0").value = "";
        }

        const chargenurse2 = document.querySelector('#CN1 option:checked');
        if (chargenurse2.value != "") {
            document.getElementById("CN_skill1").value = chargenurse2.dataset.skill;
        }
        else {
            document.getElementById("CN_skill1").value = "";
        }

        const chargenurse3 = document.querySelector('#CN2 option:checked');
        if (chargenurse3.value != "") {
            document.getElementById("CN_skill2").value = chargenurse3.dataset.skill;
        }
        else {
            document.getElementById("CN_skill2").value = "";
        }
    }

    function updateSNDetails() {
        for (i = 0; i < 3; i++) {
            const supportnurse = document.querySelector(`#SN${i} option:checked`);
            if (supportnurse.value != "") {
                document.getElementById(`SN_area${i}`).value = supportnurse.dataset.area;
                document.getElementById(`SN_rotation${i}`).value = supportnurse.dataset.rotation;
            }
            else {
                document.getElementById(`SN_area${i}`).value = "";
                document.getElementById(`SN_rotation${i}`).value = "";
            }
        }
    }

    function updateNurseDetails() {
        for (k = 0; k < 6; k++) {
            for (j = 0; j < 2; j++) {
                for (i = 0; i < 7; i++) {
                    const nurse = document.querySelector(`#Nurse${k}${j}${i} option:checked`);
                    if (nurse.value != "") {
                        document.getElementById(`Nurse_skill${k}${j}${i}`).value = nurse.dataset.skill;
                        document.getElementById(`Nurse_group${k}${j}${i}`).value = nurse.dataset.group;
                        document.getElementById(`Nurse_rotation${k}${j}${i}`).value = nurse.dataset.rotation;
                    }
                    else {
                        document.getElementById(`Nurse_skill${k}${j}${i}`).value = "";
                        document.getElementById(`Nurse_group${k}${j}${i}`).value = "";
                        document.getElementById(`Nurse_rotation${k}${j}${i}`).value = "";
                    }
                }
            }
        }
    }

    // Print Page
    function printPage() {
        var css = 'body',
            head = document.head || document.getElementsByTagName('head')[0],
            style = document.createElement('style');
        style.type = 'text/css';
        style.media = 'print';
        if (style.styleSheet) {
            style.styleSheet.cssText = css;
        } else {
            style.appendChild(document.createTextNode(css));
        }
        head.appendChild(style);
        window.print();
    }

</script>

{% endblock %}